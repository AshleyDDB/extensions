define(["exports","module","thirdparty/babel-runtime/helpers/inherits","thirdparty/babel-runtime/helpers/get","thirdparty/babel-runtime/helpers/create-class","thirdparty/babel-runtime/helpers/class-call-check","thirdparty/babel-runtime/helpers/sliced-to-array","thirdparty/babel-runtime/core-js/get-iterator","thirdparty/babel-runtime/regenerator/index","./SymbolRegistry","thirdparty/babel-runtime/helpers/interop-require","./FontView","text!../html/svg-font-view-glyphs.html"],function(t,e,r,a,n,i,s,l,o,u,h,p,f){"use strict";var c=h["default"](u),d=h["default"](p),g=h["default"](f),y=new c,v=function(t){function e(){i["default"](this,e),null!=t&&t.apply(this,arguments)}return r["default"](e,t),n["default"](e,[{key:"_load",value:function(){var t=this,e=$.Deferred();return this.getFile().read(function(r,a,n){if(null===r&&a)try{var i=$.parseXML(a.replace(/\n\r|\n|\r/g,"").match(/<svg.*?<\/svg>/i)[0]),s=$(i).find("font");s.length&&s.find("glyph").length?(t[y.get("font")]=t._sort(t[y.get("parse")](s)),e.resolve()):e.reject(new Error("Not valid font"))}catch(l){e.reject(new Error("Not valid svg"))}else e.reject(r||new Error("Empty file"))}),e.promise()}},{key:"_renderGlyphs",value:function(t){return Mustache.render(g,{glyphs:this[y.get("font")].glyphs,size:this[y.get("font")].size,emptyBlocks:new Array(t)})}},{key:"_sort",value:function(t){return t.glyphs=a["default"](Object.getPrototypeOf(e.prototype),"_sort",this).call(this,t.glyphs),t}},{key:y.get("parse"),value:function(t){var e=this,r=(t.find("font-face"),void 0),a=t.find("glyph").get().reduce(function(t,a){var n=$(a),i=n.attr("unicode"),s=n.attr("d");if(i&&s){for(var l={name:n.attr("glyph-name"),path:s},o=0;o<i.length;){var u=void 0;if("&"!==i[o]||"#"!==i[o+1])u=i.charCodeAt(o).toString(16),o++;else{var h=i.indexOf(";",o),p=i.substring(o+1,h-1);u=+("x"===p[0]?"0"+p:p).toString(16),o=h+1}l.unicode=u}t.push(l),r=e[y.get("getGlyphSize")](s,r)}return t},[]);return{size:r,glyphs:a}}},{key:y.get("parseSvgPath"),value:o["default"].mark(function u(t){var e,r,a,n,i,l,h,p,f;return o["default"].wrap(function(o){for(;;)switch(o.prev=o.next){case 0:e="mzlhvcsqta",r=/[+-]?[\d\.]+(?:e[+-]?[\d\.]+)?/.source,a={x:0,y:0},n=0;case 2:if(!(n<t.length)){o.next=24;break}if(i=t[n].toLowerCase(),!~e.indexOf(i)){o.next=21;break}l={start:"^.{"+(n+1)+"}[^"+e+"]*?",end:"\\s*(?:["+e+"]|$)"},h={},o.t0=i,o.next="m"===o.t0?9:"l"===o.t0?9:"c"===o.t0?9:"s"===o.t0?9:"q"===o.t0?9:"t"===o.t0?9:"a"===o.t0?9:"h"===o.t0?14:"v"===o.t0?14:16;break;case 9:return p=t.match(new RegExp(""+l.start+"("+r+")\\s*,?\\s*("+r+")"+l.end,"i")),f=s["default"](p,3),h.x=f[1],h.y=f[2],o.abrupt("break",16);case 14:return h["h"===i?"x":"y"]=t.match(new RegExp(""+l.start+"("+r+")"+l.end,"i"))[1],o.abrupt("break",16);case 16:return h.x=+h.x||0,h.y=+h.y||0,i===t[n]&&(h.x+=a.x,h.y+=a.y),o.next=21,a=h;case 21:n++,o.next=2;break;case 24:case"end":return o.stop()}},u,this)})},{key:y.get("getGlyphSize"),value:function(t){var e=void 0===arguments[1]?{top:0,bottom:0,right:0,left:0}:arguments[1],r=!0,a=!1,n=void 0;try{for(var i,s=l["default"](this[y.get("parseSvgPath")](t));!(r=(i=s.next()).done);r=!0){var o=i.value,u=o.x,h=o.y;e.top=Math.max(e.top,h),e.bottom=Math.min(e.bottom,h),e.right=Math.max(e.right,u),e.left=Math.min(e.left,u)}}catch(p){a=!0,n=p}finally{try{!r&&s["return"]&&s["return"]()}finally{if(a)throw n}}return e}}]),e}(d);Mustache.parse(g),e.exports=v});