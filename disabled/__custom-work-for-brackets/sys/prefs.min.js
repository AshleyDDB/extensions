define(function(e,t,o){"use strict";function b(e,t,o,r,n){c.register(e,t,o),s.addMenuItem(t,"",r,n)}function h(e,t,o){t!==o&&f.set(e,t)}function k(e,t){var o;for(o in u)if(u.hasOwnProperty(o)){var r=e.find("#"+o);if(t)r.prop(d[r.attr("type")],f.get(u[o]));else{var n=r.prop(d[r.attr("type")]),a=typeof n;"boolean"!==a&&(n=~~n),h(u[o],n,f.get(u[o]))}}}function P(e){var t=r.showModalDialogUsingTemplate(p,!0),o=t.getElement();e||k(o,!0),t.done(function(e){"cancel"!==e&&"dontsave"!==e&&"ok"===e&&(k(o),f.save())})}var p,r=brackets.getModule("widgets/Dialogs"),n=brackets.getModule("strings"),a=brackets.getModule("command/Menus"),s=a.getMenu(a.AppMenuBar.NAVIGATE_MENU),c=brackets.getModule("command/CommandManager"),i=brackets.getModule("command/Commands"),l=brackets.getModule("preferences/PreferencesManager"),f=l.getExtensionPrefs("custom.work"),u={cwPrefsReduceOpacity:"reduce.opacity",cwPrefShowWorkingFilesSidebar:"showWorkingFilesSidebar",cwPrefShowButtonForToolbar:"showButtonForToolbar",cwPrefNoSplitButton:"horizontalBar.noSplitButton",cwPrefUseIconsOfCustomWork:"useIconsOfCustomWork",cwPrefgrayScaleIcons:"grayScaleIcons",cwPrefAutoHideTheTabmenu:"autoHideTheTabmenu",cwPrefHoverSidebar:"hover.sidebar",cwPrefTooltip:"tooltip",cwPrefScrollwheel:"scrollwheel",cwPrefScrollwheelStep:"scrollwheel.step"},d={checkbox:"checked",number:"value"},g="custom.work.addon.version",m=localStorage.getItem(g),w=~~brackets.metadata.apiVersion.replace(/\D+/g,"");b("Custom Work Preferences","PreferencesforCustomWorkforBrackets",P,a.AFTER,i.NAVIGATE_PREV_DOC_LIST_ORDER),o.exports=function(e,t){var o;o=170>w?Mustache:brackets.getModule("thirdparty/mustache/mustache"),p=o.render(e,n),m||(localStorage.setItem(g,t),P(!0)),t>parseInt(m,10)&&(localStorage.setItem(g,t),P()),localStorage.getItem("cw-version-in-localStorage")&&localStorage.removeItem("cw-version-in-localStorage")}});